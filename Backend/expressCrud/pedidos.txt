const express = require('express');
const db = require('../database/config') // <-- não sei se essa parte esta certa
const router = express.Router();
const dao = require('../database/dao.pedidos');

router.get('/', function (req, res){
    dao.list().then( ([rows]) =>{
        res.json(rows)
    }).catch(err => {
        console.log(err);
        res.status(500).send('Erro ao listar "pedidos"');
    });

})

router.get('/:idPedido', function (req, res){
    const idPedido = req.params.idPedido
    dao.findById(idPedido)
        .then( ([rows]) =>{
            if (rows.length > 0) {
                res.json(rows[0]);
            } else {
                res.status(404).send('Pedido não encontrado.');
            }
    }).catch(err => {
        console.log(err);
        res.status(500).send('Erro ao listar "pedidos"');
    });
})

router.post('/', function(req, res){

    const { usuarioId, produtoId, dataEmissao, statusPedido } = req.body;
    
    dao.save(usuarioId, produtoId, dataEmissao, statusPedido)
    //Chaves Estrangeiras: Ajuste estas variáveis conforme o relacionamento no seu banco de dados
        .then( (results) =>{
            const result = results[0];
            res.status(201).json({idPedido: result.insertId});
        }).catch(err => {
            console.log(err);
            res.status(500).send('Erro ao criar pedido');
        });
})


router.put('/:idPedido', function(req, res){
    const idPedido = req.params.idPedido;
    const { usuarioId, produtoId, dataEmissao, statusPedido } = req.body;
    
    dao.update(idPedido, usuarioId, produtoId, dataEmissao, statusPedido)
    // Chaves Estrangeiras: Ajuste estas variáveis conforme o relacionamento no seu banco de dados
    .then( ([result]) =>{
        res.send("Pedido atualizado com sucesso!")
    }).catch(err => {
        console.log(err);
        res.status(500).send('Erro ao atualizar pedido');
    });
})

router.delete('/:idPedido', function(req, res){
    const idPedido = req.params.idPedido
    dao.remove(idPedido)
    .then( ([result]) =>{
        res.send("Pedido deletado com sucesso!")
    }).catch(err => {
        console.log(err);
        res.status(500).send('Erro ao deletar pedido');
    });
})

module.exports = router;
